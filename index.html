<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Millennium Falcon — SPARC Galaxies & LoCuSS Clusters (Browser Tool)</title>

  <!-- Sci-fi font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700;800&display=swap" rel="stylesheet">

  <!-- Plotly + JSZip -->
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    :root{
      --bg0:#02030a; --bg1:#070a16;
      --card:rgba(255,255,255,.075);
      --stroke:rgba(255,255,255,.18);
      --text:rgba(240,246,255,.92);
      --muted:rgba(240,246,255,.68);
      --muted2:rgba(240,246,255,.52);
      --ok:#27f2c3; --bad:#ff5470;
      --glow:rgba(120,210,255,.45);
      --glow2:rgba(200,120,255,.30);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1200px 800px at 18% 12%, rgba(90,190,255,.18), transparent 60%),
        radial-gradient(900px 700px at 84% 16%, rgba(210,110,255,.13), transparent 62%),
        radial-gradient(900px 700px at 55% 92%, rgba(100,255,220,.08), transparent 60%),
        linear-gradient(180deg,var(--bg0),var(--bg1));
      overflow-x:hidden;
    }

    /* Space background: galaxies + cluster halos + ship trail (inline SVG) */
    .space{
      position:fixed; inset:0; pointer-events:none;
      opacity:.56;
      background-image:url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='1600' height='1000' viewBox='0 0 1600 1000'>\
<defs>\
<radialGradient id='galA' cx='50%' cy='50%' r='55%'>\
<stop offset='0' stop-color='%23ffffff' stop-opacity='0.24'/>\
<stop offset='40%' stop-color='%237ad2ff' stop-opacity='0.14'/>\
<stop offset='100%' stop-color='%23000000' stop-opacity='0'/>\
</radialGradient>\
<radialGradient id='galB' cx='50%' cy='50%' r='55%'>\
<stop offset='0' stop-color='%23ffffff' stop-opacity='0.20'/>\
<stop offset='38%' stop-color='%23c878ff' stop-opacity='0.12'/>\
<stop offset='100%' stop-color='%23000000' stop-opacity='0'/>\
</radialGradient>\
<radialGradient id='halo' cx='50%' cy='50%' r='60%'>\
<stop offset='0' stop-color='%23ffffff' stop-opacity='0.08'/>\
<stop offset='55%' stop-color='%23ffffff' stop-opacity='0.02'/>\
<stop offset='100%' stop-color='%23000000' stop-opacity='0'/>\
</radialGradient>\
<linearGradient id='trail' x1='0' y1='0' x2='1' y2='0'>\
<stop offset='0' stop-color='%237ad2ff' stop-opacity='0'/>\
<stop offset='55%' stop-color='%237ad2ff' stop-opacity='0.22'/>\
<stop offset='100%' stop-color='%23c878ff' stop-opacity='0.12'/>\
</linearGradient>\
<filter id='blur8'><feGaussianBlur stdDeviation='8'/></filter>\
<filter id='blur14'><feGaussianBlur stdDeviation='14'/></filter>\
</defs>\
<rect width='1600' height='1000' fill='transparent'/>\
<g fill='%23ffffff' opacity='0.24'>\
<circle cx='71' cy='73' r='1.2'/> <circle cx='183' cy='109' r='0.9'/> <circle cx='265' cy='52' r='0.8'/> <circle cx='338' cy='146' r='1.0'/>\
<circle cx='418' cy='88' r='1.1'/> <circle cx='512' cy='132' r='0.7'/> <circle cx='603' cy='70' r='0.9'/> <circle cx='690' cy='156' r='0.8'/>\
<circle cx='781' cy='92' r='1.0'/> <circle cx='862' cy='61' r='0.7'/> <circle cx='955' cy='141' r='1.2'/> <circle cx='1040' cy='87' r='0.8'/>\
<circle cx='1141' cy='52' r='0.9'/> <circle cx='1248' cy='118' r='1.1'/> <circle cx='1362' cy='71' r='0.7'/> <circle cx='1501' cy='129' r='1.0'/>\
<circle cx='110' cy='310' r='0.8'/> <circle cx='240' cy='280' r='1.1'/> <circle cx='355' cy='330' r='0.7'/> <circle cx='505' cy='290' r='0.9'/>\
<circle cx='640' cy='320' r='1.2'/> <circle cx='790' cy='275' r='0.8'/> <circle cx='910' cy='338' r='0.9'/> <circle cx='1060' cy='300' r='1.1'/>\
<circle cx='1210' cy='332' r='0.7'/> <circle cx='1360' cy='290' r='1.0'/> <circle cx='1500' cy='320' r='0.8'/>\
<circle cx='95' cy='720' r='0.9'/> <circle cx='210' cy='690' r='0.8'/> <circle cx='330' cy='770' r='1.1'/> <circle cx='470' cy='705' r='0.7'/>\
<circle cx='610' cy='780' r='1.2'/> <circle cx='760' cy='700' r='0.8'/> <circle cx='910' cy='760' r='1.0'/> <circle cx='1060' cy='710' r='0.9'/>\
<circle cx='1210' cy='790' r='0.8'/> <circle cx='1370' cy='720' r='1.1'/> <circle cx='1510' cy='780' r='0.7'/>\
</g>\
<g filter='url(%23blur14)' opacity='0.98'>\
<ellipse cx='280' cy='210' rx='250' ry='150' fill='url(%23galA)'/>\
<ellipse cx='1220' cy='240' rx='300' ry='170' fill='url(%23galB)'/>\
<ellipse cx='820' cy='780' rx='360' ry='200' fill='url(%23galA)'/>\
</g>\
<g filter='url(%23blur8)' opacity='0.98'>\
<circle cx='520' cy='520' r='240' fill='url(%23halo)'/>\
<circle cx='1040' cy='560' r='280' fill='url(%23halo)'/>\
</g>\
<path d='M 80 880 C 420 650, 760 640, 1120 380 C 1300 250, 1450 220, 1560 180' stroke='url(%23trail)' stroke-width='10' fill='none' opacity='0.58'/>\
<path d='M 120 900 C 460 680, 780 660, 1150 410 C 1320 280, 1470 240, 1580 190' stroke='url(%23trail)' stroke-width='4' fill='none' opacity='0.48'/>\
</svg>");
      background-size:cover;
      background-position:center;
      mix-blend-mode:screen;
      filter:saturate(1.30) contrast(1.12);
    }

    .wrap{max-width:1320px;margin:0 auto;padding:28px 16px 74px; position:relative}
    .top{display:flex;align-items:flex-end;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:14px}
    h1{
      margin:0;
      font-family:'Orbitron',system-ui;
      font-size:46px;
      letter-spacing:1.7px;
      text-transform:uppercase;
      text-shadow:0 0 40px var(--glow), 0 0 80px rgba(120,210,255,.14);
      line-height:1.02;
    }
    .badge{
      display:inline-flex;width:max-content;
      padding:7px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
      font-family:'Orbitron',system-ui;
      font-size:12px; letter-spacing:1.15px;
      color:rgba(240,246,255,.78);
      box-shadow:0 0 26px rgba(120,210,255,.10);
      margin-top:6px;
    }
    .sub{color:var(--muted); font-size:16px; max-width:980px; line-height:1.35}

    .nav{display:flex;gap:10px;flex-wrap:wrap}
    .pill{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      color:rgba(240,246,255,.86);
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      font-weight:1000;
      user-select:none;
      font-size:14px;
      letter-spacing:.35px;
      transition:transform .08s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
    }
    .pill:hover{transform:translateY(-1px); border-color:rgba(255,255,255,.30)}
    .pill.active{
      background:linear-gradient(90deg, rgba(120,210,255,.34), rgba(200,120,255,.22));
      box-shadow:0 0 34px rgba(120,210,255,.16);
      color:rgba(240,246,255,.96);
    }

    .layout{display:grid; grid-template-columns: 480px 1fr; gap:14px}
    @media (max-width: 1080px){ .layout{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--stroke);
      background:var(--card);
      border-radius:20px;
      padding:16px;
      box-shadow:0 14px 80px rgba(0,0,0,.40);
      backdrop-filter:blur(10px);
    }
    .card h2{margin:0 0 8px; font-size:19px; letter-spacing:.4px}
    .mini{color:var(--muted); font-size:14px; line-height:1.35}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; color:rgba(240,246,255,.86)}
    label{display:block; margin-top:10px; font-size:14px; color:var(--muted)}
    input,select,button{
      width:100%;
      padding:12px 12px;
      margin-top:8px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(10,14,24,.62);
      color: rgba(240,246,255,.92);
      outline:none;
      font-size:16px;
    }
    button{
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.6px;
      transition: transform .08s ease, border-color .15s ease, box-shadow .15s ease, filter .15s ease;
      user-select:none;
      position:relative;
      overflow:hidden;
      text-transform:uppercase;
    }
    button:hover{transform:translateY(-1px); border-color:rgba(255,255,255,.32); filter:saturate(1.12)}
    button:disabled{opacity:.55; cursor:not-allowed; filter:none; transform:none}
    .primary{
      background: linear-gradient(90deg, rgba(120,210,255,.34), rgba(200,120,255,.22));
      box-shadow:0 0 44px rgba(120,210,255,.16);
    }
    .primary::after{
      content:"";
      position:absolute; inset:-60% -60%;
      background: radial-gradient(circle at 28% 22%, rgba(255,255,255,.20), transparent 45%);
      transform: rotate(10deg);
      opacity:.85;
      pointer-events:none;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .row > button{flex:1; min-width:170px}
    .hr{height:1px; background:rgba(255,255,255,.12); margin:12px 0}
    .kpi{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top:10px}
    @media (max-width: 680px){ .kpi{grid-template-columns:1fr} }
    .kpi .box{border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:10px 12px;background: rgba(255,255,255,.03)}
    .kpi b{display:block; font-size:14px; color:rgba(240,246,255,.78); margin-bottom:4px}
    .kpi span{font-size:16px}
    .plotcard{padding:10px 12px}
    #plotSparc,#plotLocuss{height:820px}
    #plotGlobal{height:820px}

    footer{
      position:relative;
      padding:18px 16px 24px;
      text-align:center;
      color:rgba(240,246,255,.60);
      font-size:13px;
    }

    /* ===== PREMIUM ADD-ONS ===== */
    .heroRow{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:12px;
      align-items:stretch;
    }

    .heroKpis{
      flex: 1 1 520px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border-radius:18px;
      padding:12px 14px;
      box-shadow: 0 18px 90px rgba(0,0,0,.34);
      backdrop-filter: blur(10px);
    }

    .heroKpis .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width: 720px){
      .heroKpis .grid{ grid-template-columns:1fr; }
    }

    .heroKpis .k{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px 12px;
    }
    .heroKpis .k b{
      display:block;
      font-size:12px;
      letter-spacing:.35px;
      color: rgba(240,246,255,.72);
      margin-bottom:6px;
    }
    .heroKpis .k span{
      font-size:15px;
      color: rgba(240,246,255,.92);
    }

    .quickLinks{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .quickLinks a{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      text-decoration:none;
      color: rgba(240,246,255,.90);
      font-weight:950;
      letter-spacing:.25px;
      transition: transform .10s ease, border-color .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .quickLinks a:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.30);
      box-shadow: 0 14px 50px rgba(0,0,0,.22);
      filter:saturate(1.10);
    }

    .heroShot{
      flex: 1 1 360px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      border-radius:18px;
      padding:10px;
      box-shadow: 0 18px 90px rgba(0,0,0,.34);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .heroShot img{
      width:100%;
      height:auto;
      display:block;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      opacity:.96;
    }
    .heroShot .cap{
      margin-top:8px;
      color: rgba(240,246,255,.62);
      font-size:12.5px;
    }
  </style>
</head>

<body>
  <div class="space"></div>

  <div class="wrap">
    <div class="top">
      <div>
        <h1>Millennium Falcon</h1>

        <div class="badge">SPARC (175) · LoCuSS (40) · One-Click Export · Auto-Load Ready</div>

        <div class="sub">
          <b>What to do:</b> choose <b>SPARC</b> or <b>LoCuSS</b>, set the input constant, and click <b>Run/Compute</b>.<br/>
          <b>What you get:</b> predicted curves/outputs + error metrics, with <b>PNG</b> and <b>CSV</b> export in one click.<br/>
          <span style="color:var(--muted2)">Runs fully in your browser (no server). SPARC dataset auto-loads from this repository.</span>
          <br/>
          <span style="color:var(--muted2)">
            <b>Key point:</b> <br/> single global constant applied to the full sample — <b>no per-object fitting</b>, no individual tuning.
          </span>
        </div>

        <!-- PREMIUM: demo notice + quick links + KPI + screenshot -->
        <div class="heroRow">

          <div class="heroKpis">
            <div class="mini" style="margin-bottom:10px">
              <b>Live demo:</b> on page load, the tool automatically runs the first valid SPARC galaxy.
              <span style="color:var(--muted2)">If auto-load fails, use Manual load or Downloads.</span>
            </div>

            <div class="grid">
              <div class="k">
                <b>Dataset</b>
                <span id="heroDataset">Auto-loading…</span>
              </div>
              <div class="k">
                <b>Selected</b>
                <span id="heroSelected">—</span>
              </div>
              <div class="k">
                <b>RMS</b>
                <span id="heroRms">—</span>
              </div>
            </div>

            
          </div>

          </div>

        </div>
      </div>

      <div class="nav">
        <div class="pill active" data-view="sparc">SPARC Galaxies</div>
        <div class="pill" data-view="locuss">LoCuSS Clusters</div>
        <div class="pill" data-view="dwarfs">Dwarfs</div>
        <div class="pill" data-view="downloads">Downloads</div>
        <div class="pill" data-view="global">Global Tests</div>
      </div>
    </div>

    <!-- SPARC -->
    <section id="view-sparc">
      <div class="layout">
        <div class="card">
          <h2>SPARC Rotation Curves (175)</h2>
          <div class="mini">Auto-load is ON. Manual load remains as fallback.</div>
          <div class="mini" style="margin-top:6px"><b>Quickstart:</b> (1) Pick a galaxy → (2) Click <b>Run</b>.</div>

          <div id="zipStatus" class="mini" style="margin-top:10px">Loading SPARC database…</div>

<div class="row" style="gap:10px; flex-wrap:wrap; margin-top:10px;">
  <button id="btnGoV12" type="button">v12 Theory</button>
  <button id="btnToggleV12" type="button">Show/Hide v12</button>
</div>

<div id="lawBanner" style="margin-top:10px;padding:10px 12px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:rgba(0,0,0,.25);font-size:14px;line-height:1.35;display:none;"></div>

          <label>Manual load (Rotmod_LTG.zip)</label>
          <input id="sparcFile" type="file" accept=".zip"/>
          <div class="mini" id="perfOut" style="margin-top:6px"></div>

          <label>Galaxy</label>
          <select id="galaxySelect" disabled></select>

          <label>τ (seconds) → mapped to a⋆ (galactic scale)</label>
          <input id="tau" type="number" step="any" value="1.2831e-25"/>

          <label>Optional: override a⋆ (m/s²)</label>
          <input id="astarOverride" type="number" step="any" placeholder=""/>

          <div class="row" style="margin-top:10px">
            <button class="primary" id="btnRunGalaxy" disabled>Run Galaxy</button>
            <button id="btnLoadZip" disabled>Load ZIP</button>
            <button id="btnCSV" disabled>Download CSV</button>
            <button id="btnPNG" disabled>Download PNG</button>
          </div>

          <div class="hr"></div>

          <div class="kpi">
            <div class="box"><b>Galaxy</b><span id="kpiGalaxy">—</span></div>
            <div class="box"><b>RMS (km/s)</b><span id="kpiRMS">—</span></div>
            <div class="box"><b>a⋆ (m/s²)</b><span id="kpiAstar">—</span></div>
          </div>

          <div class="hr"></div>

          <div class="mini">
            <b>Definition</b><br/>
            <span class="mono">Vbar² = Vgas² + Vdisk² + Vbulge²</span><br/>
            <span class="mono">aN(r) = Vbar² / r</span><br/>
            <span class="mono">a(r) = √(aN·a⋆)</span><br/>
            <span class="mono">Vpred(r) = √(r·a)</span>
          </div>
        </div>

        <div class="card plotcard"><div id="plotSparc"></div></div>
      </div>
    </section>

    <!-- LoCuSS -->
    <section id="view-locuss" style="display:none">
      <div class="layout">
        <div class="card">
          <h2>LoCuSS R500 Tester (40)</h2>
          <div class="mini">Compute ξ and ξtop, then export plot/table.</div>
          <div class="mini" style="margin-top:6px"><b>Quickstart:</b> (1) Choose cluster → (2) Click <b>Compute</b>.</div>

          <label>a⋆ (m/s²)</label>
          <input id="locussAstar" type="number" step="any" value="1.55e-10"/>

          <label>ε (global slope removal)</label>
          <input id="locussEps" type="number" step="any" value="0.704"/>

          <label>Cluster</label>
          <select id="clusterSelect"></select>

          <div class="row" style="margin-top:10px">
            <button class="primary" id="btnRunLocuss">Compute</button>
            <button id="btnLocussCSV">Download CSV</button>
            <button id="btnLocussPNG">Download PNG</button>
            <button id="btnReset">Reset defaults</button>
          </div>

          <div class="hr"></div>

          <div class="row">
            <button id="btnHistXi">Hist ξ</button>
            <button id="btnHistTop">Hist ξtop</button>
            <button id="btnXiVsM">ξ vs MWL</button>
            <button id="btnTopVsM">ξtop vs MWL</button>
          </div>

          <div class="hr"></div>
          <div class="mini" id="locussOut"></div>
        </div>

        <div class="card plotcard"><div id="plotLocuss"></div></div>
      </div>
    </section>

    <!-- ===== Dwarfs (McConnachie / Wolf) ===== -->
<section id="view-dwarfs" style="display:none; margin-top:16px">
  <h2 style="margin:10px 0">Dwarf Galaxies</h2>

  <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
    <input id="dwarfFile" type="file" accept=".csv,.txt,.dat" />

    <button id="btnRunDwarfs" disabled>Run Dwarfs</button>
    <button id="btnDwarfsCSV" disabled>Export Dwarfs CSV</button>
    <button id="btnDwarfsPNG" disabled>Export Dwarfs PNG</button>
  </div>

  <div id="dwarfsOut" style="margin-top:10px"></div>

  <div id="plotDwarfs" style="height:520px; margin-top:10px"></div>
</section>

<!-- Downloads -->
    <section id="view-downloads" style="display:none">
      <div class="card">
        <h2>Downloads</h2>
        <div class="mini">
          <b>Needed file (optional):</b> <span class="mono">Rotmod_LTG.zip</span><br/>
          If auto-load fails, download the SPARC zip and load it manually using the file picker.<br/>
          <span style="color:var(--muted2)">Tip: keep the zip in the repo root for best auto-load behavior.</span>
          <br/><br/>
          <span style="color:rgba(240,246,255,.60)">
            All computations are performed locally in your browser. No data is sent to any server.
          </span>
        </div>
      </div>
    </section>

    <!-- Global Tests -->
    <section id="view-global" style="display:none">
      <div class="layout">
        <div class="card">
          <h2>Global Tests</h2>
          <div class="mini">
            One-click global views: <b>BTFR</b> (SPARC 175) and <b>LoCuSS</b> (40).
          </div>

          <div class="hr"></div>

          <div class="row">
  <button id="btnBTFR" type="button">Build BTFR (175)</button>
</div>


            <button class="primary" id="btnGlobalRMS">Global RMS (175)</button>
          <button id="btnGlobalCSV" type="button" disabled>Download Global CSV</button>



            <button id="btnLocussGlobal">LoCuSS: Mdyn vs Mbar</button>
          </div>

          <div class="hr"></div>

          <div class="mini" id="globalOut"></div>
        </div>

        <div class="card plotcard"><div id="plotGlobal"></div></div>
      </div>

      <div class="hr"></div>

      <div class="mini" style="padding:12px;border:1px solid rgba(255,255,255,.14);border-radius:16px;background:rgba(255,255,255,.03)">
        <b>Falsifiability:</b> If you find an object that does not match using <b>one global constant</b> (no per-object fitting), the claim is falsified.
      </div>
    </section>


  </div><!-- /wrap -->

  <footer>
    © 2026 José Fabián Vallejos — Argentina<br/>
    Born in Argentina, created for humanity<br/>
    <span style="color:rgba(240,246,255,.45)">Browser-only tool for SPARC galaxies & LoCuSS clusters</span>
    <br/>
    <span style="color:rgba(240,246,255,.40)">
      Educational & exploratory tool. Uses public SPARC and LoCuSS datasets.
    </span>
  </footer>

  
  <script>
    (function(){
      const pills = Array.from(document.querySelectorAll('.pill[data-view]'));
      const views = {
        sparc: document.getElementById('view-sparc'),
        locuss: document.getElementById('view-locuss'),
        dwarfs: document.getElementById('view-dwarfs'),
        downloads: document.getElementById('view-downloads'),
        global: document.getElementById('view-global'),
      };
      function show(name){
        pills.forEach(p=>p.classList.toggle('active', p.dataset.view===name));
        Object.entries(views).forEach(([k,el])=>{ if(el) el.style.display = (k===name ? '' : 'none'); });
        setTimeout(()=>{
          ['plotSparc','plotLocuss','plotDwarfs','plotGlobal'].forEach(id=>{
            const el = document.getElementById(id);
            if(el && window.Plotly){ try{ Plotly.Plots.resize(el);}catch(e){} }
          });
        }, 80);
      }
      pills.forEach(p=>p.addEventListener('click', ()=>show(p.dataset.view)));
      show('sparc');
    })();
  </script>
<script>
// ==========================================================
// Millennium Falcon — Inline SPARC CSV backend (no conflicts)
// - FileReader + robust parser (comma OR whitespace)
// - QUOT/OHM motor: geff = sqrt(gN^2 + gN*a*)
// - Reads UI inputs: tau + astarOverride (override wins)
// ==========================================================
window.MF = window.MF || {};
(function(MF){
  const KPC_TO_M = 3.085677581e19;
  MF.SPARC_ROWS = [];

  function el(id){ return document.getElementById(id); }

  MF.readTextFile = function(file){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = e => resolve(e.target.result);
      reader.onerror = err => reject(err);
      reader.readAsText(file);
    });
  };

  MF.parseSPARC = function(text){
    const lines = text.split(/\r?\n/).filter(l=>l.trim() && !l.trim().startsWith("#"));
    MF.SPARC_ROWS = [];
    for(const line of lines){
      const trimmed = line.trim();
      const parts = trimmed.includes(",") ? trimmed.split(",") : trimmed.split(/\s+/);
      const nums = parts.map(s=>Number(s));
      if(!isFinite(nums[0]) || !isFinite(nums[1])) continue;
      MF.SPARC_ROWS.push({
        r: nums[0],
        vobs: nums[1],
        vgas: nums[2] ?? 0,
        vdisk: nums[3] ?? 0,
        vbulge: nums[4] ?? 0
      });
    }

    // Enable run/export
    const ok = MF.SPARC_ROWS.length > 0;
    if (el("btnRunGalaxy")) el("btnRunGalaxy").disabled = !ok;
    if (el("btnCSV")) el("btnCSV").disabled = !ok;
    if (el("btnPNG")) el("btnPNG").disabled = !ok;

    if (el("kpiGalaxy")) el("kpiGalaxy").textContent = ok ? "Loaded (CSV)" : "—";
    if (el("heroDataset")) el("heroDataset").textContent = ok ? "Manual CSV" : "—";
    return MF.SPARC_ROWS.length;
  };

  function getAstar(){
    const override = parseFloat(el("astarOverride")?.value || "");
    if (isFinite(override) && override>0) return override;
    return 1.5e-10;
  }

  MF.predictVel = function(){
    if(!MF.SPARC_ROWS.length) return;

    const ML = 0.51;   // global
    const ASTAR = getAstar();

    const rads=[], obs=[], pred=[];
    for(const p of MF.SPARC_ROWS){
      const Vbar2 = (p.vgas*p.vgas) + ML*((p.vdisk*p.vdisk) + (p.vbulge*p.vbulge));
      const r_m = p.r * KPC_TO_M;
      const gN = (Vbar2 * 1e6) / r_m;          // (km/s)^2 -> (m/s)^2
      const geff = Math.sqrt(gN*gN + gN*ASTAR);
      const v_kms = Math.sqrt(r_m*geff)/1000;

      rads.push(p.r);
      obs.push(p.vobs);
      pred.push(v_kms);
    }

    MF.plotGalaxy(rads, obs, pred);
    MF.updateRMS(obs, pred, ASTAR);
  };

  MF.plotGalaxy = function(r, o, p){
    if(!window.Plotly) return;
    Plotly.newPlot("plotSparc",[
      {x:r, y:o, name:"Observed", mode:"lines+markers"},
      {x:r, y:p, name:"QUOT", mode:"lines"}
    ], {
      margin:{l:50,r:20,t:25,b:45},
      paper_bgcolor:"rgba(0,0,0,0)",
      plot_bgcolor:"rgba(0,0,0,0)",
      xaxis:{title:"r (kpc)"},
      yaxis:{title:"V (km/s)"}
    });
  };

  MF.updateRMS = function(o, p, ASTAR){
    let s=0;
    for(let i=0;i<o.length;i++) s += (o[i]-p[i])*(o[i]-p[i]);
    const rms = Math.sqrt(s/o.length);

    if (el("kpiRMS")) el("kpiRMS").textContent = rms.toFixed(2);
    if (el("heroRms")) el("heroRms").textContent = rms.toFixed(2) + " km/s";
    if (el("kpiAstar")) el("kpiAstar").textContent = ASTAR.toExponential(3);
    if (el("heroSelected")) el("heroSelected").textContent = el("galaxySelect")?.value || "CSV manual";
  };

  // Wire UI
  const sparcFile = el("sparcFile");
  if (sparcFile){
    sparcFile.addEventListener("change", async (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const txt = await MF.readTextFile(file);
      MF.parseSPARC(txt);
    });
  }

  if (el("btnRunGalaxy")){
    el("btnRunGalaxy").addEventListener("click", MF.predictVel);
  }

  if (el("btnPNG")){
    el("btnPNG").addEventListener("click", async ()=>{
      if(!window.Plotly) return;
      try{ await Plotly.downloadImage("plotSparc", {format:"png", filename:"millennium_falcon_sparc"}); }catch(e){}
    });
  }

  if (el("btnCSV")){
    el("btnCSV").addEventListener("click", ()=>{
      if(!MF.SPARC_ROWS.length) return;
      const header = "r_kpc,vobs_kms,vgas_kms,vdisk_kms,vbulge_kms\n";
      const body = MF.SPARC_ROWS.map(p=>[p.r,p.vobs,p.vgas,p.vdisk,p.vbulge].join(",")).join("\n");
      const blob = new Blob([header+body], {type:"text/csv"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "sparc_loaded.csv";
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 600);
    });
  }
})(window.MF);
</script>

<!-- Your app logic -->
 <!-- Optional external app.js. If kept, ensure it does NOT redefine MF.* or bind duplicate handlers. -->
  <section id="ipNotice" style="margin:28px auto 10px; max-width:1100px; padding:16px 18px; border-top:1px solid rgba(255,255,255,.12); opacity:0.95;">
  <h3 style="margin:0 0 8px; font-size:16px;">Propiedad Intelectual &amp; Uso</h3>
  <p style="margin:0 0 8px; font-size:13px; line-height:1.45;">
    © <span id="ipYear"></span> José Fabián Vallejos. Este software, su interfaz, el modelo matemático implementado, y la metodología de cálculo asociada
    constituyen obra original y están protegidos por derechos de autor (Argentina – Ley 11.723) y convenios internacionales.
  </p>
  <p style="margin:0 0 8px; font-size:13px; line-height:1.45;">
    <strong>INPI Argentina:</strong> Para registro/depósito y constancias formales, completa aquí tus datos cuando corresponda:
    <em>Expediente/Trámite INPI:</em> <span style="border-bottom:1px dotted rgba(255,255,255,.35); padding:0 6px;">__________</span>
  </p>
  <p style="margin:0; font-size:12.5px; line-height:1.45; opacity:0.9;">
    Prohibida la reproducción, re-implementación, ingeniería inversa o uso comercial sin autorización escrita del autor.
    Para licencias o acuerdos: reemplaza este texto con tu contacto oficial.
  </p>
</section>
<script>
  try{ document.getElementById("ipYear").textContent = new Date().getFullYear(); }catch(e){}
</script>


<section id="v12Dynamics" style="margin:40px auto 10px; max-width:1100px; padding:20px; border-top:1px solid rgba(255,255,255,.12);">
  <h2 style="margin:0 0 10px; font-size:20px;">v12 — Dynamic Coherence Field (Vallejos)</h2>
  <p style="margin:0 0 10px; font-size:14px; line-height:1.5;">
    In v12, the empirical coherence factor <b>C</b> is promoted from a numerical parameter to a physical scalar field Φ(x,t).
    The framework becomes a scalar–tensor theory where matter couples conformally to spacetime through Φ.
  </p>

  <h3 style="margin:14px 0 8px; font-size:16px;">Action Principle</h3>
  <pre style="margin:0 0 10px; padding:12px; border-radius:10px; background:rgba(0,0,0,.35); overflow:auto; font-size:13px; line-height:1.35;">
S = ∫ d⁴x √−g [ R/(16πG)
              + ½ ∂μΦ ∂μΦ
              − V(Φ)
              + Lm(e^{2βΦ} gμν , ψm) ]
  </pre>

  <h3 style="margin:14px 0 8px; font-size:16px;">Field Equation</h3>
  <pre style="margin:0 0 10px; padding:12px; border-radius:10px; background:rgba(0,0,0,.35); overflow:auto; font-size:13px; line-height:1.35;">
□Φ = dV/dΦ − β T
  </pre>

  <h3 style="margin:14px 0 8px; font-size:16px;">Emergent Vallejos Factor</h3>
  <pre style="margin:0 0 10px; padding:12px; border-radius:10px; background:rgba(0,0,0,.35); overflow:auto; font-size:13px; line-height:1.35;">
C = e^{-2βΦ}
V → V / √C
  </pre>

  <ul style="margin:8px 0 0 18px; font-size:14px; line-height:1.5;">
    <li>Φ defines a local coherence state of spacetime.</li>
    <li>C &lt; 1 corresponds to reduced effective inertia in the effective (conformal) frame.</li>
    <li>The v11 velocity law is the quasi-static astrophysical limit of this field theory.</li>
  </ul>

  <p style="margin:14px 0 0; font-size:13px; opacity:.85; line-height:1.5;">
    Status: this section is the theoretical field framework (paper-grade). All plots above correspond to stationary astrophysical solutions.
  </p>
</section>


<script>
(function(){
  function $(id){ return document.getElementById(id); }
  function go(){ var s=$("v12Dynamics"); if(s) s.scrollIntoView({behavior:"smooth", block:"start"}); }
  function toggle(){
    var s=$("v12Dynamics"); if(!s) return;
    s.style.display = (s.style.display==="none") ? "block" : "none";
  }
  document.addEventListener("DOMContentLoaded", function(){
    var a=$("btnGoV12"); if(a) a.addEventListener("click", go);
    var b=$("btnToggleV12"); if(b) b.addEventListener("click", toggle);
  });
})();
</script>


<script src="app_PROTECTED_v12_NOEVAL_1771712818.js"></script>
</body>
</html>
